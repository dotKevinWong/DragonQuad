<!DOCTYPE html>
<html>
<head>
	<title>Post an Event - DragonQuad</title>
    <h2>Post an Event</h2>
</head>
<body>
	<progress value="0" max="100" id="uploader">0%</progress>
	<input type="file" value="upload" accept="image/*" id="fileButton">
    
	<script src="https://www.gstatic.com/firebasejs/4.2.0/firebase.js"></script>
	<script>
		// Initialize Firebase
		var config = {
            apiKey: "AIzaSyAzwi29rBFn2Tzp4riCWaLRvpGNaafGDqE",
            authDomain: "dragonquad-32573.firebaseapp.com",
            databaseURL: "https://dragonquad-32573.firebaseio.com",
            projectId: "dragonquad-32573",
            storageBucket: "dragonquad-32573.appspot.com",
            messagingSenderId: "240943759488"
		};
		firebase.initializeApp(config);
	</script>
	<script type="text/javascript">

		// get elements
		var uploader = document.getElementById('uploader');
		var fileButton = document.getElementById('fileButton');

		// listen for file selection
		fileButton.addEventListener('change', function (e) {

			// output to console
			console.log('file upload event', e);

			// get file
			var file = e.target.files[0];

			// storage ref
			var storageRef = firebase.storage().ref('eventImages/' + file.name );

			// upload file (POST command)
			var uploadTask = storageRef.put(file);

			// update progress bar
			uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED, // or 'state_changed'
				function (snapshot) {
					// Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
					var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
					uploader.value = progress;
					console.log('Upload is ' + progress + '% done');
					switch (snapshot.state) {
						case firebase.storage.TaskState.PAUSED: // or 'paused'
							console.log('Upload is paused');
							break;
						case firebase.storage.TaskState.RUNNING: // or 'running'
							console.log('Upload is running');
							break;
					}
				}, function (error) {

					// A full list of error codes is available at
					// https://firebase.google.com/docs/storage/web/handle-errors
					switch (error.code) {
						case 'storage/unauthorized':
							// User doesn't have permission to access the object
							break;

						case 'storage/canceled':
							// User canceled the upload
							break;

						case 'storage/unknown':
							// Unknown error occurred, inspect error.serverResponse
							break;
					}
				}, function () {
					// Upload completed successfully, now we can get the download URL
					// save this link somewhere, e.g. put it in an input field
					var downloadURL = uploadTask.snapshot.downloadURL;
					console.log('downloadURL', downloadURL);
				});

		});
	</script>
</body>
</html>